<!DOCTYPE html>
<html>
  <head>
    <title>Socket.IO chat</title>
  </head>

  <body>
    <h3>Chat App</h3>

    <div id="messages">

    </div>

    <form>
      <input type="text" id="inputMessage" />
      <button id="send">Send</button>
    </form>
    <button id="location" style="margin-top: 20px">Send location</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ==" crossorigin="anonymous"></script>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      var socket = io();

      document.querySelector("#send").addEventListener("click", (event) => {
        event.preventDefault();

        let message = document.querySelector("#inputMessage").value;

        if (message.length != 0) {
          document.querySelector("#send").setAttribute("disabled", "disabled");

          socket.emit("sendMessage", message, (message) => {
            console.log(message);
          });

          document.querySelector("#send").removeAttribute("disabled");

          document.querySelector("#inputMessage").value = "";
          document.querySelector("#inputMessage").focus();
        } else {
          alert("Enter message");
        }
      });

      socket.on("sendMessage", (message) => {
        
          var div = document.createElement("div");
          div.style["font-size"] = "15px"; 
          div.style["margin-top"] = "10px"; 
          div.style["margin-bottom"] = "10px";

          div.innerText = moment().format("h:mm a")  + " - " + message

          document.querySelector('#messages').append(div)

      });

      socket.on("locationMessage", (url) => {
        
        var div = document.createElement("div");
        div.style["font-size"] = "15px"; 
        div.style["margin-top"] = "10px"; 
        div.style["margin-bottom"] = "10px";
        div.innerText = moment().format("h:mm a")  + " - "

        var a = document.createElement("a"); 
        a.innerText = 'My Current location!'
        a.href = url
        a.target = "_blank"

        div.append(a)

          document.querySelector('#messages').append(div)
      });

      document.querySelector("#location").addEventListener("click", (event) => {
        if (!navigator.geolocation) {
          return alert("Geolocation is not supported by your browser.");
        }
        document
          .querySelector("#location")
          .setAttribute("disabled", "disabled");
        navigator.geolocation.getCurrentPosition((position) => {
          socket.emit(
            "sendLocation",
            {
              latitude: position.coords.latitude,
              longitude: position.coords.longitude,
            },
            (message) => {
              console.log(message);
            }
          );

          document.querySelector("#location").removeAttribute("disabled");
        });
      });
    </script>
  </body>
</html>
